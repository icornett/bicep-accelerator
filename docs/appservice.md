# appservice br:icornett.azurecr.io/bicep/modules/appservice:v1.0

## Parameters

| Parameter Name         | Parameter Type | Parameter Description                                                                                                                                                      | Parameter DefaultValue     | Parameter AllowedValues                                                                               |
| ---------------------- | -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------- | ----------------------------------------------------------------------------------------------------- |
| apimInstanceName       | string         | The name of the API Management instance                                                                                                                                    |                            |                                                                                                       |
| apimResourceGroupName  | string         | The resource group of the API Management Instance                                                                                                                          |                            |                                                                                                       |
| apimSubscriptionId     | string         | The subscription ID for the API Management Instance                                                                                                                        |                            |                                                                                                       |
| apiName                | string         | The name of the API to bind to the App Service                                                                                                                             |                            |                                                                                                       |
| appName                | string         | The name of the application the CR belongs to                                                                                                                              |                            |                                                                                                       |
| appServicePlanName     | string         | The name of the App Service Plan instance                                                                                                                                  |                            |                                                                                                       |
| appSvcKind             | string         | The kind of app service plan to deploy, module will need some tuning for Windows support.                                                                                  | linux                      | windows,linux                                                                                         |
| containerRegistryName  | string         | The name of the container regisry containing the app image                                                                                                                 |                            |                                                                                                       |
| elasticScaleEnabled    | bool           | ServerFarm supports ElasticScale. Apps in this plan will scale as if the ServerFarm was ElasticPremium sku                                                                 | False                      |                                                                                                       |
| healthCheckPath        | string         | The path for the app health check                                                                                                                                          | /health                    |                                                                                                       |
| imageName              | string         | The name of the image in the registry, including tag name e.g. mycontainer:mytag                                                                                           |                            |                                                                                                       |
| keyVaultName           | string         | The name of the key vault instance                                                                                                                                         |                            |                                                                                                       |
| loadBalancingType      | string         | Site load balancing type                                                                                                                                                   | PerSiteRoundRobin          | LeastRequests,LeastResponseTime,PerSiteRoundRobin,RequestHash,WeightedRoundRobin,WeightedTotalTraffic |
| location               | string         | The location to deploy the storage account to                                                                                                                              | [resourceGroup().location] |                                                                                                       |
| perSiteScaling         | bool           | If `true`, apps assigned to this App Service plan can be scaled independently. If `false`, apps assigned to this App Service plan will scale to all instances of the plan. | False                      |                                                                                                       |
| redundancyMode         | string         | Site redundancy mode                                                                                                                                                       | Manual                     | ActiveActive,Failover,GeoRedundant,Manual,None                                                        |
| resourceGroupName      | string         | The name of the resource group for scope                                                                                                                                   |                            |                                                                                                       |
| skuCapacity            | int            |                                                                                                                                                                            |                            |                                                                                                       |
| skuName                | string         | The Name of the resource SKU.                                                                                                                                              |                            | B1,B2,B3,S1,S2,S3,P1v2,P2v2,P3v2,P0v3,P1v3,P2v3,P3v3,P1mv3,P2mv3,P3mv3,P4mv3,P5mv3                    |
| subscriptionId         | string         | The subscription Id of the subcription containing the container registry                                                                                                   |                            |                                                                                                       |
| tags                   | object         | A mapping of tags to assign to the resource                                                                                                                                |                            |                                                                                                       |
| usePublicNetworkAccess | bool           | Use public network for application                                                                                                                                         | False                      |                                                                                                       |
| vnetName               | string         | The name of the virtual network                                                                                                                                            |                            |                                                                                                       |
| vnetRgName             | string         | The name of the resource group containing the virtual network                                                                                                              |                            |                                                                                                       |
| websiteEndpointSubnet  | string         | The subnet for the website endpoint                                                                                                                                        |                            |                                                                                                       |
| websiteTimeZone        | string         | The configured time zone of the application, can be found [here](https://timezonedb.com/time-zones)                                                                        |                            |                                                                                                       |
| webSubnetName          | string         | The app pool subnet name                                                                                                                                                   |                            |                                                                                                       |
| zoneRedundant          | bool           | If true, this App Service Plan will perform availability zone balancing. If false, this App Service Plan will not perform availability zone balancing.                     | False                      |                                                                                                       |

## Resources

| Deployment Name             | Resource Type                                    | Resource Version   | Existing | Resource Comment |
| --------------------------- | ------------------------------------------------ | ------------------ | -------- | ---------------- |
| acr                         | Microsoft.ContainerRegistry/registries           | 2022-02-01-preview | True     |                  |
| acrUser                     | Microsoft.ManagedIdentity/userAssignedIdentities | 2022-01-31-preview | True     |                  |
| appService                  | Microsoft.Web/sites                              | 2022-09-01         | False    |                  |
| appServicePlan              | Microsoft.Web/serverfarms                        | 2022-03-01         | False    |                  |
| appSlot                     | Microsoft.Web/sites/slots                        | 2022-03-01         | False    |                  |
| appSvcVnetConnection        | Microsoft.Web/sites/virtualNetworkConnections    | 2022-03-01         | False    |                  |
| keyVault                    | Microsoft.KeyVault/vaults                        | 2022-07-01         | True     |                  |
| roleAssignment              | Microsoft.Authorization/roleAssignments          | 2020-10-01-preview | False    |                  |
| slotEndpoint                | Microsoft.Network/privateEndpoints               | 2022-01-01         | False    |                  |
| slotRoleAssignment          | Microsoft.Authorization/roleAssignments          | 2020-10-01-preview | False    |                  |
| webEndpoint                 | Microsoft.Network/privateEndpoints               | 2022-01-01         | False    |                  |
| websiteMetricsPublisher     | Microsoft.Authorization/roleAssignments          | 2020-10-01-preview | False    |                  |
| websiteSlotMetricsPublisher | Microsoft.Authorization/roleAssignments          | 2020-10-01-preview | False    |                  |

## Outputs

| Output Name | Output Type | Output Value            |
| ----------- | ----------- | ----------------------- |
| name        | string      | [parameters('appName')] |
