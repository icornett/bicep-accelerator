# cosmosdb br:slalombicepregistry.azurecr.io/bicep/modules/cosmosdb:v1.0

## Parameters

| Parameter Name                     | Parameter Type | Parameter Description                                                                                                                                                                                                                                          | Parameter DefaultValue     | Parameter AllowedValues                                   |
| ---------------------------------- | -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------- | --------------------------------------------------------- |
| backupIntervalInMinutes            | int            | An integer representing the interval in minutes between two backups, 240 (4h) is included for free                                                                                                                                                             | 240                        |                                                           |
| backupRetentionIntervalInHours     | int            |                                                                                                                                                                                                                                                                | 8                          |                                                           |
| backupStorageRedundancy            | string         | Indicate type of backup residency                                                                                                                                                                                                                              | Local                      | Geo,Zone,Local                                            |
| backupType                         | string         | Set the type of backup you would like to perform                                                                                                                                                                                                               | Periodic                   | Periodic,Continuous                                       |
| dbSubnetName                       | string         | The name of the subnet for the private endpoint                                                                                                                                                                                                                |                            |                                                           |
| defaultConsistencyLevel            | string         | The default consistency level of the Cosmos DB account.                                                                                                                                                                                                        | Session                    | Eventual,ConsistentPrefix,Session,BoundedStaleness,Strong |
| disableKeyBasedMetadataWriteAccess | bool           | Disable write operations on metadata resources (databases, containers, throughput) via account keys                                                                                                                                                            | True                       |                                                           |
| enableAutomaticFailover            | bool           | Enable system managed failover for regions                                                                                                                                                                                                                     | True                       |                                                           |
| enableCassandra                    | bool           | Enable Cassandra Backend.                                                                                                                                                                                                                                      | False                      |                                                           |
| enableGremlin                      | bool           | Enable Gremlin Backend API.                                                                                                                                                                                                                                    | False                      |                                                           |
| enableMultipleWriteLocations       | bool           | Multi-region writes capability allows you to take advantage of the provisioned throughput for your databases and containers across the globe. This is disabled for serverless instances                                                                        | True                       |                                                           |
| enableServerless                   | bool           | Enable Serverless for consumption-based usage, should be false if using `SqlDedicated` `groupId`                                                                                                                                                               | True                       |                                                           |
| enableTables                       | bool           | Enable Table DB API.                                                                                                                                                                                                                                           | False                      |                                                           |
| groupIds                           | array          | The group ids to pass to the private endpoint, see [docs](https://learn.microsoft.com/en-us/azure/cosmos-db/how-to-configure-private-endpoints#private-zone-name-mapping) for more details                                                                     | [array('sql')]             | sql,sqldedicated,cassandra,mongodb,gremlin,table          |
| isZoneRedundant                    | bool           | Toggle to enable or disable zone redudance.                                                                                                                                                                                                                    | False                      |                                                           |
| location                           | string         | The primary deployment location                                                                                                                                                                                                                                | [resourceGroup().location] |                                                           |
| maxIntervalInSeconds               | int            | Max lag time (minutes). Required for BoundedStaleness. Valid ranges, Single Region: 5 to 84600. Multi Region: 300 to 86400.                                                                                                                                    | 300                        |                                                           |
| maxStalenessPrefix                 | int            | Max stale requests. Required for BoundedStaleness. Valid ranges, Single Region: 10 to 2147483647. Multi Region: 100000 to 2147483647.                                                                                                                          | 100000                     |                                                           |
| postfix                            | string         | The prepared postfix for resources                                                                                                                                                                                                                             |                            |                                                           |
| secondaryLocations                 | array          | array of region objects or regions: [region: string]                                                                                                                                                                                                           |                            |                                                           |
| tags                               | object         | A mapping of tags to assign to resources                                                                                                                                                                                                                       |                            |                                                           |
| totalThroughputLimit               | int            | The total throughput limit imposed on the account. A totalThroughputLimit of 2000 imposes a strict limit of max throughput that can be provisioned on that account to be 2000. A totalThroughputLimit of -1 indicates no limits on provisioning of throughput. | 4000                       |                                                           |
| virtualNetworkFilterEnabled        | bool           | Flag to indicate whether to enable/disable Virtual Network ACL rules.                                                                                                                                                                                          | True                       |                                                           |
| vnetName                           | string         | The name of the virtual network                                                                                                                                                                                                                                |                            |                                                           |
| vnetRgName                         | string         | The name of the resource group containing the virtual network                                                                                                                                                                                                  |                            |                                                           |

## Resources

| Deployment Name | Resource Type                         | Resource Version | Existing | Resource Comment |
| --------------- | ------------------------------------- | ---------------- | -------- | ---------------- |
| cosmosDbAccount | Microsoft.DocumentDB/databaseAccounts | 2022-11-15       | False    |                  |
| lock            | Microsoft.Authorization/locks         | 2020-05-01       | False    |                  |
| privateEndpoint | Microsoft.Network/privateEndpoints    | 2022-09-01       | False    |                  |

## Outputs

| Output Name | Output Type | Output Value                                                                                       |
| ----------- | ----------- | -------------------------------------------------------------------------------------------------- |
| id          | string      | [resourceId('Microsoft.DocumentDB/databaseAccounts', format('cosmos-{0}', parameters('postfix')))] |
| name        | string      | [format('cosmos-{0}', parameters('postfix'))]                                                      |
